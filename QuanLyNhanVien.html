<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống quản lý nhân viên</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        input[readonly] {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }
        .avatar-upload {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        .avatar-upload .avatar-preview {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }
        .avatar-upload .upload-btn {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .avatar-upload .upload-btn:hover {
            background: #2563eb;
            transform: scale(1.1);
        }
        .avatar-upload input[type="file"] {
            display: none;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .scrollable-form {
            max-height: 80vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Quản lý nhân viên</h1>
        
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
            <!-- Search Box -->
            <div class="relative max-w-md">
                <input type="text" placeholder="Tìm kiếm nhân viên..." 
                    class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fas fa-search text-gray-400"></i>
                </div>
            </div>
            
            <button id="addEmployeeBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center justify-center md:justify-start">
                <i class="fas fa-plus mr-2"></i> Thêm nhân viên
            </button>
        </div>

        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('name')">
                                <div class="flex items-center">
                                    Nhân viên
                                    <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('employeeCode')">
                                <div class="flex items-center">
                                    Mã NV
                                    <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('position')">
                                <div class="flex items-center">
                                    Chức vụ
                                    <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('department')">
                                <div class="flex items-center">
                                    Phòng ban
                                    <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('email')">
                                <div class="flex items-center">
                                    Liên hệ
                                    <i class="fas fa-sort ml-1 text-gray-400"></i>
                                </div>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="employeeTableBody">
                        <!-- Employee data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Pagination Controls -->
    <div class="flex items-center justify-between mt-4">
        <div class="text-sm text-gray-500 ml-4">
            Hiển thị <span id="startItem">1</span>-<span id="endItem">8</span> của <span id="totalItems">0</span> nhân viên
        </div>
        <div class="flex space-x-2">
            <button id="prevPage" class="px-3 py-1 border rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50" disabled>
                <i class="fas fa-chevron-left"></i>
            </button>
            <div id="pageNumbers" class="flex space-x-1"></div>
            <button id="nextPage" class="px-3 py-1 border rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Add/Edit Employee Modal -->
    <div id="employeeModal" class="modal fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none">
        <div class="modal-overlay absolute inset-0 bg-black opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-3xl mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <h3 class="text-2xl font-bold" id="modalTitle">Thêm nhân viên mới</h3>
                    <button id="closeModalBtn" class="modal-close cursor-pointer z-50">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="scrollable-form">
                    <form id="employeeForm" class="space-y-4">
                        <input type="hidden" id="employeeId">
                        
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="w-full md:w-1/3">
                                <div class="avatar-upload mb-4">
                                    <div class="avatar-preview bg-gray-200 flex items-center justify-center">
                                        <i class="fas fa-user text-4xl text-gray-400" id="avatarPreviewIcon"></i>
                                        <img id="avatarPreview" class="hidden w-full h-full object-cover rounded-full" src="" alt="Avatar Preview">
                                    </div>
                                    <div class="upload-btn">
                                        <i class="fas fa-camera"></i>
                                        <input type="file" id="avatarInput" accept="image/*">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="w-full md:w-2/3 space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="name" class="block text-sm font-medium text-gray-700">Họ tên <span class="text-red-600">*</span></label>
                                        <input type="text" id="name" name="name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                    </div>
                                    <div>
                                        <label for="employeeCode" class="block text-sm font-medium text-gray-700">Mã nhân viên <span class="text-red-600">*</span></label>
                                        <input type="text" id="employeeCode" name="employeeCode" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="position" class="block text-sm font-medium text-gray-700">Chức vụ <span class="text-red-600">*</span></label>
                                        <select id="position" name="position" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                            <option value="">Chọn chức vụ</option>
                                            <option value="Manager">Manager</option>
                                            <option value="Developer">Developer</option>
                                            <option value="Designer">Designer</option>
                                            <option value="HR">HR</option>
                                            <option value="Accountant">Accountant</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="department" class="block text-sm font-medium text-gray-700">Phòng ban <span class="text-red-600">*</span></label>
                                        <select id="department" name="department" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                            <option value="">Chọn phòng ban</option>
                                            <option value="IT">IT</option>
                                            <option value="HR">Human Resources</option>
                                            <option value="Finance">Finance</option>
                                            <option value="Marketing">Marketing</option>
                                            <option value="Operations">Operations</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="gender" class="block text-sm font-medium text-gray-700">Giới tính</label>
                                        <select id="gender" name="gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                            <option value="">Chọn giới tính</option>
                                            <option value="Male">Nam</option>
                                            <option value="Female">Nữ</option>
                                            <option value="Other">Khác</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="dob" class="block text-sm font-medium text-gray-700">Ngày sinh</label>
                                        <input type="text" id="dob" name="dob"
                                                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border"
                                                                    placeholder="dd/mm/yyyy">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-4">
                            <h4 class="text-lg font-medium text-gray-800 mb-4">Thông tin liên hệ</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                                    <input type="email" id="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                </div>
                                <div>
                                    <label for="phone" class="block text-sm font-medium text-gray-700">Số điện thoại</label>
                                    <input type="tel" id="phone" name="phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                </div>
                                <div>
                                    <label for="mobile" class="block text-sm font-medium text-gray-700">Di động</label>
                                    <input type="tel" id="mobile" name="mobile" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                </div>
                                <div>
                                    <label for="address" class="block text-sm font-medium text-gray-700">Địa chỉ</label>
                                    <input type="text" id="address" name="address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border">
                                </div>
                            </div>
                            <!-- Sau phần address -->
                            <div class="border-t border-gray-200 pt-4">
                            <h4 class="text-lg font-medium text-gray-800 mt-6 mb-4">Thông tin bổ sung</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Ngày bắt đầu / kết thúc -->
                                <div>
                                <label for="startDate" class="block text-sm font-medium text-gray-700">Ngày bắt đầu làm</label>
                                <input type="text" id="startDate" name="startDate"
                                                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border"
                                                                    placeholder="dd/mm/yyyy">
                                </div>
                                <div>
                                <label for="endDate" class="block text-sm font-medium text-gray-700">Ngày kết thúc</label>
                                <input type="text" id="endDate" name="endDate"
                                                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border"
                                                                    placeholder="dd/mm/yyyy">
                                </div>
                                <!-- Trình độ học vấn & Thuế -->
                                <div>
                                <label for="education" class="block text-sm font-medium text-gray-700">Trình độ học vấn</label>
                                <input type="text" id="education" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                <div>
                                <label for="taxType" class="block text-sm font-medium text-gray-700">Loại thuế TNCN</label>
                                <input type="text" id="taxType" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                <div>
                                <label for="taxCode" class="block text-sm font-medium text-gray-700">Mã số thuế TNCN</label>
                                <input type="text" id="taxCode" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                
                                <!-- CMND/CCCD -->
                                <div>
                                <label for="idIssueDate" class="block text-sm font-medium text-gray-700">Ngày cấp CMND/CCCD</label>
                                <input type="date" id="idIssueDate" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                <div>
                                <label for="idNumber" class="block text-sm font-medium text-gray-700">Số CMND/CCCD</label>
                                <input type="text" id="idNumber" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                <div>
                                <label for="idIssuePlace" class="block text-sm font-medium text-gray-700">Nơi cấp</label>
                                <input type="text" id="idIssuePlace" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                <!-- Ngân hàng & Số tài khoản -->
                                <div>
                                <label for="bank" class="block text-sm font-medium text-gray-700">Ngân hàng</label>
                                <input type="text" id="bank" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                <div>
                                <label for="bankAccount" class="block text-sm font-medium text-gray-700">Tài khoản ngân hàng</label>
                                <input type="text" id="bankAccount" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                
                                

                                <!-- Quốc tịch, dân tộc, tôn giáo -->
                                <div>
                                <label for="nationality" class="block text-sm font-medium text-gray-700">Quốc tịch</label>
                                <input type="text" id="nationality" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                <div>
                                <label for="ethnicity" class="block text-sm font-medium text-gray-700">Dân tộc</label>
                                <input type="text" id="ethnicity" class="mt-1 w-full rounded-md border p-2">
                                </div>
                                <div>
                                <label for="religion" class="block text-sm font-medium text-gray-700">Tôn giáo</label>
                                <input type="text" id="religion" class="mt-1 w-full rounded-md border p-2">
                                </div>

                                <!-- Ghi chú -->
                                <div class="md:col-span-2">
                                <label for="note" class="block text-sm font-medium text-gray-700">Ghi chú</label>
                                <textarea id="note" rows="2" class="mt-1 w-full rounded-md border p-2"></textarea>
                                </div>
                            </div>
                            </div>

                        </div>
                        
                        <div class="sticky bottom-0 bg-white border-t px-4 py-2 flex justify-end space-x-2">
                            <button type="button" id="cancelBtn" class="px-3 py-1.5 bg-gray-200 hover:bg-gray-300 rounded text-sm">Hủy</button>
                            <button type="submit" class="px-3 py-1.5 bg-blue-600 text-white hover:bg-blue-700 rounded text-sm">Lưu</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none">
        <div class="modal-overlay absolute inset-0 bg-black opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <h3 class="text-xl font-bold">Xác nhận xóa</h3>
                    <button id="closeDeleteModalBtn" class="modal-close cursor-pointer z-50">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <p class="text-gray-700 mb-6">Bạn có chắc muốn xóa nhân viên này.</p>
                
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelDeleteBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Hủy</button>
                    <button type="button" id="confirmDeleteBtn" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">Xóa</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sort state
        let currentSort = {
            field: null,
            direction: 'asc' // 'asc' or 'desc'
        };

        // Pagination variables
        let currentPage = 1;
        const itemsPerPage = 8;
        let totalPages = 1;

        // Sample employee data
        let employees = [
            {
                id: 1,
                avatar: '',
                name: 'Nguyễn Quốc Huy',
                employeeCode: 'EMP001',
                position: 'Developer',
                department: 'IT',
                gender: 'Male',
                dob: '30-09-2002',
                email: 'quochuy@example.com',
                phone: '0123456789',
                mobile: '0987654321',
                address: '123 Main St, City'
            },
            {
                id: 2,
                name: 'Trần Thị Mai',
                employeeCode: 'EMP002',
                position: 'HR',
                department: 'Human Resources'
            },
            {
                id: 3,
                name: 'Lê Văn Tùng',
                employeeCode: 'EMP003',
                position: 'Accountant',
                department: 'Finance'
            },
            {
                id: 4,
                name: 'Phạm Thị Hương',
                employeeCode: 'EMP004',
                position: 'Designer',
                department: 'Marketing'
            },
            {
                id: 5,
                name: 'Hoàng Văn Nam',
                employeeCode: 'EMP005',
                position: 'Manager',
                department: 'Operations'
            },
            {
                id: 6,
                name: 'Vũ Thị Lan',
                employeeCode: 'EMP006',
                position: 'Developer',
                department: 'IT'
            },
            {
                id: 7,
                name: 'Đặng Văn Sơn',
                employeeCode: 'EMP007',
                position: 'HR',
                department: 'Human Resources'
            },
            {
                id: 8,
                name: 'Bùi Thị Hoa',
                employeeCode: 'EMP008',
                position: 'Accountant',
                department: 'Finance'
            },
            {
                id: 9,
                name: 'Nguyễn Văn Đạt',
                employeeCode: 'EMP009',
                position: 'Designer',
                department: 'Marketing'
            },
            {
                id: 10,
                name: 'Trần Văn Minh',
                employeeCode: 'EMP010',
                position: 'Manager',
                department: 'Operations'
            },
            {
                id: 11,
                name: 'Lê Thị Hồng',
                employeeCode: 'EMP011',
                position: 'Developer',
                department: 'IT'
            }
        ];

        // DOM elements
        const employeeTableBody = document.getElementById('employeeTableBody');
        const addEmployeeBtn = document.getElementById('addEmployeeBtn');
        const employeeModal = document.getElementById('employeeModal');
        const deleteModal = document.getElementById('deleteModal');
        const employeeForm = document.getElementById('employeeForm');
        const modalTitle = document.getElementById('modalTitle');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const closeDeleteModalBtn = document.getElementById('closeDeleteModalBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const avatarInput = document.getElementById('avatarInput');
        const avatarPreview = document.getElementById('avatarPreview');
        const avatarPreviewIcon = document.getElementById('avatarPreviewIcon');

        // Current employee to be deleted
        let employeeToDelete = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            renderEmployeeTable();
            updatePaginationInfo();
            setupEventListeners();
        });
        
        flatpickr("#dob", {
            dateFormat: "d/m/Y", // dd/mm/yyyy
            maxDate: "today",
            allowInput: true
        });

        flatpickr("#startDate", {
            dateFormat: "d/m/Y", // dd/mm/yyyy
            maxDate: "today",
            allowInput: true
        });

        flatpickr("#endDate", {
            dateFormat: "d/m/Y", // dd/mm/yyyy
            maxDate: "today",
            allowInput: true
        });
        // Get paginated employees
        function getPaginatedEmployees() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            return employees.slice(startIndex, startIndex + itemsPerPage);
        }

        // Update pagination info
        function updatePaginationInfo() {
            totalPages = Math.ceil(employees.length / itemsPerPage);
            const startItem = (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(startItem + itemsPerPage - 1, employees.length);
            
            document.getElementById('startItem').textContent = startItem;
            document.getElementById('endItem').textContent = endItem;
            document.getElementById('totalItems').textContent = employees.length;
            
            // Update pagination buttons
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
            
            // Update page numbers
            const pageNumbersContainer = document.getElementById('pageNumbers');
            pageNumbersContainer.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `px-3 py-1 border rounded-md ${i === currentPage ? 'bg-blue-500 text-white' : 'text-gray-700 hover:bg-gray-50'}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    renderEmployeeTable();
                });
                pageNumbersContainer.appendChild(pageBtn);
            }
        }

        // Render employee table
        function renderEmployeeTable() {
            updateSortIcons();
            employeeTableBody.innerHTML = '';
            updatePaginationInfo();
            
            const paginatedEmployees = getPaginatedEmployees();
            
            paginatedEmployees.forEach(employee => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center">
                                ${employee.avatar ? 
                                    `<img class="h-10 w-10 rounded-full" src="${employee.avatar}" alt="${employee.name}">` : 
                                    `<i class="fas fa-user text-gray-400"></i>`}
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">${employee.name}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${employee.employeeCode}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${employee.position}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${employee.department}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${employee.email}<br>${employee.mobile || employee.phone}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex items-left justify-left h-full space-x-3">
                            <button class="text-blue-600 hover:text-blue-900 edit-btn" data-id="${employee.id}">
                            <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-900 delete-btn" data-id="${employee.id}">
                            <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>

                `;
                employeeTableBody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.currentTarget.getAttribute('data-id'));
                    editEmployee(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.currentTarget.getAttribute('data-id'));
                    showDeleteModal(id);
                });
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Add employee button
            addEmployeeBtn.addEventListener('click', () => {
                modalTitle.textContent = 'Thêm nhân viên mới';
                employeeForm.reset();
                document.getElementById('employeeId').value = '';
                document.getElementById('employeeCode').readOnly = false;
                avatarPreview.src = '';
                avatarPreview.classList.add('hidden');
                avatarPreviewIcon.classList.remove('hidden');
                showModal(employeeModal);
            });
            
            // Close modal buttons
            closeModalBtn.addEventListener('click', () => hideModal(employeeModal));
            cancelBtn.addEventListener('click', () => hideModal(employeeModal));
            
            // Close delete modal buttons
            closeDeleteModalBtn.addEventListener('click', () => hideModal(deleteModal));
            cancelDeleteBtn.addEventListener('click', () => hideModal(deleteModal));
            
            // Confirm delete button
            confirmDeleteBtn.addEventListener('click', () => {
                if (employeeToDelete) {
                    deleteEmployee(employeeToDelete);
                    hideModal(deleteModal);
                    employeeToDelete = null;
                }
            });
            
            // Avatar upload
            const uploadBtn = document.querySelector('.upload-btn');
            uploadBtn.addEventListener('click', () => {
                avatarInput.click();
            });

            avatarInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    // Validate file type
                    if (!file.type.match('image.*')) {
                        alert('Vui lòng chọn file ảnh (JPEG, PNG, GIF)');
                        return;
                    }

                    // Validate file size (max 2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        alert('Kích thước ảnh tối đa là 2MB');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        avatarPreview.src = event.target.result;
                        avatarPreview.classList.remove('hidden');
                        avatarPreviewIcon.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Pagination buttons
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderEmployeeTable();
                }
            });

            document.getElementById('nextPage').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderEmployeeTable();
                }
            });

            // Form submission
            employeeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveEmployee();
            });
        }

        // Show modal
        function showModal(modal) {
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.classList.add('opacity-100', 'pointer-events-auto');
        }

        // Hide modal
        function hideModal(modal) {
            modal.classList.remove('opacity-100', 'pointer-events-auto');
            modal.classList.add('opacity-0', 'pointer-events-none');
        }

        // Edit employee
        function editEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (employee) {
                modalTitle.textContent = 'Chỉnh sửa thông tin nhân viên';
                document.getElementById('employeeId').value = employee.id;
                document.getElementById('name').value = employee.name;
                const employeeCodeInput = document.getElementById('employeeCode');
                employeeCodeInput.value = employee.employeeCode;
                employeeCodeInput.readOnly = true;
                employeeCodeInput.classList.add('bg-gray-100');
                document.getElementById('position').value = employee.position;
                document.getElementById('department').value = employee.department;
                document.getElementById('gender').value = employee.gender;
                document.getElementById('dob').value = employee.dob;
                document.getElementById('email').value = employee.email;
                document.getElementById('phone').value = employee.phone;
                document.getElementById('mobile').value = employee.mobile;
                document.getElementById('address').value = employee.address;
                
                if (employee.avatar) {
                    avatarPreview.src = employee.avatar;
                    avatarPreview.classList.remove('hidden');
                    avatarPreviewIcon.classList.add('hidden');
                } else {
                    avatarPreview.src = '';
                    avatarPreview.classList.add('hidden');
                    avatarPreviewIcon.classList.remove('hidden');
                }
                
                showModal(employeeModal);
            }
        }

        // Show delete confirmation modal
        function showDeleteModal(id) {
            employeeToDelete = id;
            showModal(deleteModal);
        }

        // Save employee (add or update)
        function saveEmployee() {
            currentPage = 1;
            const id = document.getElementById('employeeId').value;
            const avatar = avatarPreview.src || '';
            const name = document.getElementById('name').value;
            const employeeCode = document.getElementById('employeeCode').value;
            const position = document.getElementById('position').value;
            const department = document.getElementById('department').value;
            const gender = document.getElementById('gender').value;
            const dob = document.getElementById('dob').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const mobile = document.getElementById('mobile').value;
            const address = document.getElementById('address').value;
            
            if (id) {
                // Update existing employee
                const index = employees.findIndex(emp => emp.id === parseInt(id));
                if (index !== -1) {
                    employees[index] = {
                        ...employees[index], avatar, name, employeeCode, position, department, gender, dob, email, phone, mobile, address
                    };
                }
            } else {
                // Add new employee
                const newId = employees.length > 0 ? Math.max(...employees.map(emp => emp.id)) + 1 : 1;
                employees.push({
                    id: newId, avatar, name, employeeCode, position, department, gender, dob, email, phone, mobile, address
                });
            }
            
            hideModal(employeeModal);
            renderEmployeeTable();
        }

        // Delete employee
        function deleteEmployee(id) {
            currentPage = 1;
            employees = employees.filter(emp => emp.id !== id);
            renderEmployeeTable();
        }

        // Sort table
        function sortTable(field) {
            // Update sort direction
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'asc';
            }

            // Sort employees
            employees.sort((a, b) => {
                const valueA = a[field]?.toString().toLowerCase() || '';
                const valueB = b[field]?.toString().toLowerCase() || '';

                if (valueA < valueB) {
                    return currentSort.direction === 'asc' ? -1 : 1;
                }
                if (valueA > valueB) {
                    return currentSort.direction === 'asc' ? 1 : -1;
                }
                return 0;
            });

            renderEmployeeTable();
            updateSortIcons();
        }

        // Update sort icons
        function updateSortIcons() {
            document.querySelectorAll('[onclick^="sortTable"]').forEach(header => {
                const icon = header.querySelector('i');
                const field = header.getAttribute('onclick').replace('sortTable(\'', '').replace('\')', '');
                
                if (currentSort.field === field) {
                    icon.className = currentSort.direction === 'asc' 
                        ? 'fas fa-sort-up ml-1 text-gray-700' 
                        : 'fas fa-sort-down ml-1 text-gray-700';
                } else {
                    icon.className = 'fas fa-sort ml-1 text-gray-400';
                }
            });
        }
    </script>
</body>
</html>